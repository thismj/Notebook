# Android性能优化

## 性能优化工具

### **Profile GPU Rendering**

| 柱状图颜色 | 渲染阶段            | 说明                                                         |
| ---------- | ------------------- | ------------------------------------------------------------ |
| 橘色       | 交换缓冲区          | 代表cpu在等待gpu完成工作,如果过高代表GPU需要完成的工作过多.  |
|            |                     |                                                              |
|            |                     |                                                              |
| 深蓝色     | 绘制                | 代表创建更新DisplayList的时间，过高代表在onDraw中花费过多时间,可能是自定义画图操作太多或执行了其它操作. |
| 淡绿色     | 测量/布局           | 代表了 onLayout 和 onMeasure 方法消耗的总时间，这段很高代表遍历整个view树结构花费了太多时间 |
|            |                     |                                                              |
|            |                     |                                                              |
| 墨绿色     | 其他时间/VSync 延迟 | 代表在连续两帧间的时间间隔,可能是因为子线程执行时间过长抢占了UI线程被cpu执行的机会. |

## 启动优化

[深入探索Android启动速度优化（上）](https://juejin.cn/post/6844904093786308622#heading-69)

[深入探索Android启动速度优化（下）](https://juejin.cn/post/6870457006784774152)

[一线大厂资深APP性能优化系列-异步优化与拓扑排序（二）](https://juejin.cn/post/6844904152670142477)

### windowBackground

预设Window背景，避免启动白屏，增加Splash页面

### 懒加载

按需初始化，特别是**针对于一些应用启动时不需要初始化的库**，可以等到用时才进行加载；使用 IdleHandler 进行懒加载

### 异步初始化

* 启动器思想，每个需要初始化的组件抽象为一个 Task 实例
* 指定各个 Task 之间的依赖关系，构造一个 Task 的有向无环图，通过拓扑排序优化确定 Task 的初始化顺序 
* 线程池并发执行各个 Task 的初始化，通过同步手段（例如CountDownLatch）保证 Task 执行的依赖关系

实践经验：

确定是否每个组件的异步初始化耗时是大致平均的，这样更有优化的意义，如果总体的耗时时间很长，但是只有某个组件初始化耗时很长，其它组件的初始化耗时很少，则优化的效果不明显，发挥不出并发初始化的优势。

### 黑科技

* 启动阶段抑制GC
* CPU锁频
* 数据重排 [facebook redex](https://github.com/facebook/redex)




